<!DOCTYPE html>
<html>
<head>
  <title>Friend System</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { margin: 5px; }
    .tab { margin: 10px 0; }
  </style>
</head>
<body>
  <h3>üë• Friend System</h3>
  <p>Logged in as: <span id="username">Loading...</span></p>

  <div class="tab">
    <button onclick="showAllUsers()">All Users</button>
    <button onclick="showMyFriends()">My Friends</button>
    <label style="float:right;">
      <input type="checkbox" id="notifyToggle" onchange="toggleNotifications(this)">
      ‚ö†Ô∏è Enable Notifications
    </label>
  </div>

  <div id="content"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCBP-uiChoUl6DExnwc9xvrCMj9Sbj72sg",
      authDomain: "chat-ee464.firebaseapp.com",
      databaseURL: "https://chat-ee464-default-rtdb.firebaseio.com",
      projectId: "chat-ee464",
      storageBucket: "chat-ee464.appspot.com",
      messagingSenderId: "967011465942",
      appId: "1:967011465942:web:83b030b334275afc4c6777"
    };
    firebase.initializeApp(firebaseConfig);

    const uid = localStorage.getItem("chat_uid");
    const name = localStorage.getItem("chat_name");

    document.getElementById("username").innerText = name || "Unknown";

    function showAllUsers() {
      const content = document.getElementById("content");
      content.innerHTML = "<h4>All Users</h4>";

      firebase.database().ref("users").once("value").then(snapshot => {
        const users = snapshot.val();
        for (let id in users) {
          if (id !== uid) {
            const user = users[id];
            const div = document.createElement("div");
            div.innerHTML = `<b>${user.name}</b> (${user.email}) <button onclick="addFriend('${id}')">Add Friend</button>`;
            content.appendChild(div);
          }
        }
      });
    }

    function showMyFriends() {
      const content = document.getElementById("content");
      content.innerHTML = "<h4>My Friends</h4>";

      firebase.database().ref("friends/" + uid).once("value").then(snapshot => {
        const friends = snapshot.val();
        if (!friends) {
          content.innerHTML += "<p>No friends found.</p>";
          return;
        }
        for (let fid in friends) {
          firebase.database().ref("users/" + fid).once("value").then(userSnap => {
            const user = userSnap.val();
            const div = document.createElement("div");
            div.innerHTML = `<b>${user.name}</b> (${user.email})`;
            content.appendChild(div);
          });
        }
      });
    }

    function addFriend(friendUid) {
      const myRef = firebase.database().ref("friends/" + uid + "/" + friendUid);
      const theirRef = firebase.database().ref("friends/" + friendUid + "/" + uid);
      myRef.set(true);
      theirRef.set(true);
      alert("Friend added!");
    }

    function toggleNotifications(checkbox) {
      if (checkbox.checked) {
        alert("Notifications enabled.");
      } else {
        alert("Notifications disabled.");
      }
    }

    // Optional: Load All Users by default
    window.onload = showAllUsers;
  </script>
</body>
</html>
